
<!DOCTYPE html>

<html lang="en">
  <head><!-- Google tag (gtag.js) -->
<script async src="https://www.googletagmanager.com/gtag/js?id=G-C89QBCQ4PJ"></script>
<script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'G-C89QBCQ4PJ');
</script>

    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.18.1: http://docutils.sourceforge.net/" />

    <title>Stimulation devices &#8212; PySilSub 0.1.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/_sphinx_javascript_frameworks_compat.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Silent substitution problems" href="03c_silent_substitution_problems.html" />
    <link rel="prev" title="Colorimetric observer models" href="03a_colorimetric_observers.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 150;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
.jp-RenderedHTMLCommon table,
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
.jp-RenderedHTMLCommon thead,
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
.jp-RenderedHTMLCommon tr,
.jp-RenderedHTMLCommon th,
.jp-RenderedHTMLCommon td,
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
.jp-RenderedHTMLCommon th,
div.rendered_html th {
  font-weight: bold;
}
.jp-RenderedHTMLCommon tbody tr:nth-child(odd),
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
.jp-RenderedHTMLCommon tbody tr:hover,
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Stimulation-devices">
<h1>Stimulation devices<a class="headerlink" href="#Stimulation-devices" title="Permalink to this heading">¶</a></h1>
<p>Silent substitution requires a stimulation device with at least as many primaries as there are photoreceptors under consideration. This generally means that <a class="reference internal" href="01_background.html"><span class="doc">5 primaries are needed</span></a>, although 4 primaries may suffice when working in the photopic range as rod photoreceptors are thought to become saturated and incapable of signalling above 300 cd/m<span class="math notranslate nohighlight">\(^2\)</span> (<a class="reference external" href="https://doi.org/10.1080/713818657">Aguiller and Stiles, 1954</a>; <a class="reference external" href="https://doi.org/10.1016/0042-6989(82)90143-2">Adelson,
1982</a>; but see <a class="reference external" href="https://iovs.arvojournals.org/article.aspx?articleid=2200107">Shapiro, 2002</a>; <a class="reference external" href="https://doi.org/10.1007/s10633-008-9159-0">Kremers et al., 2009</a>).</p>
<p>The primaries should be independantly addressable, additive, and ideally stable over time with a linear gamma function. Peak wavelength and bandwidth are key considerations that will ultimately define the gamut and available contrast (<a class="reference external" href="https://doi.org/10.1364/josaa.420373">Evéquoz et al., 2021</a>), and the light source will also need to be integrated into an optical setup for stimulus delivery—usually either a Ganzfeld (e.g., <a class="reference external" href="https://doi.org/10.3758/s13428-021-01759-3">Martin et al., 2021</a>)
or Maxwellian (e.g., <a class="reference external" href="https://doi.org/10.1167/15.1.27">Cao et al., 2015</a>).</p>
<p><a class="reference external" href="https://doi.org/10.3390/photonics7040121">Conus and Geiser (2020)</a> reviewed stimulation devices from a range of silent substitution studies and found that, in most cases, the device had 4 or 5 primaries and was built from scratch using LEDs, optical bench components, and microprocessors, such as Arduino, for pulse width modulation control of intensity. Only a few devices were commercially bought.</p>
<p>Whatever the device and setup, one must obtain accurate calibration measurements with a spectrometer to characterise the output. If you have a <a class="reference external" href="https://www.jeti.com/">JETI</a> or <a class="reference external" href="https://www.oceaninsight.com/">OceanOptics</a> spectrometer, <a class="reference external" href="https://github.com/PyPlr/cvd_pupillometry">PyPlr</a> has some Python interfaces that may help you obtain the spectral measurements.</p>
<p>Once you have these measurements, you are ready to use <em>PySilSub</em>.</p>
<section id="pysilsub.devices.StimulationDevice">
<h2><code class="docutils literal notranslate"><span class="pre">pysilsub.devices.StimulationDevice</span></code><a class="headerlink" href="#pysilsub.devices.StimulationDevice" title="Permalink to this heading">¶</a></h2>
<p>This class aims to serve as a software model for any multiprimary stimulation device. It can be instantiated as follows:</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysilsub.devices</span> <span class="kn">import</span> <span class="n">StimulationDevice</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">StimulationDevice</span><span class="p">(</span>
    <span class="n">calibration</span><span class="o">=</span><span class="s1">&#39;../../pysilsub/data/STLAB_1_York.csv&#39;</span><span class="p">,</span>
    <span class="n">calibration_wavelengths</span><span class="o">=</span><span class="p">[</span><span class="mi">380</span><span class="p">,</span> <span class="mi">781</span><span class="p">,</span> <span class="mi">1</span><span class="p">],</span>
    <span class="n">primary_resolutions</span><span class="o">=</span><span class="p">[</span><span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">,</span> <span class="mi">4095</span><span class="p">],</span>
    <span class="n">primary_colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blueviolet&#39;</span><span class="p">,</span> <span class="s1">&#39;royalblue&#39;</span><span class="p">,</span> <span class="s1">&#39;darkblue&#39;</span><span class="p">,</span> <span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;lime&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">,</span> <span class="s1">&#39;darkred&#39;</span><span class="p">],</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;SpectraTuneLab&#39;</span><span class="p">,</span>
    <span class="n">config</span><span class="o">=</span><span class="nb">dict</span><span class="p">(</span><span class="n">calibration_units</span><span class="o">=</span><span class="s1">&#39;$\mu$W/m$^2$/nm&#39;</span><span class="p">)</span>
<span class="p">)</span>
<br/></pre></div>
</div>
</div>
<p>The above example is for a commercial 10-primary device with 12-bit resolution (<a class="reference external" href="https://ledmotive.com/store/spectratune-lab/">STLAB: Ledmotive Technologies LLC</a>), which means the input is specified with values between 0 and 4095.</p>
<p>The calibration file is a CSV with accurate spectral measurements of the individual primaries. The first row contains column headers <em>Primary</em> and <em>Setting</em>, and numbers to describe the wavelength sampling of the measurements. The remaining rows each contain a spectral measurement and corresponding values for <em>Primary</em> and <em>Setting</em> for identification.</p>
<p>Note that one must also include a dark measurement where LEDs are turned off (i.e., Setting = 0) to account for ambient light in an experimental setup.</p>
<p>The calibration data look like this:</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span><span class="o">.</span><span class="n">calibration</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Wavelength</th>
      <th>380</th>
      <th>381</th>
      <th>382</th>
      <th>383</th>
      <th>384</th>
      <th>385</th>
      <th>386</th>
      <th>387</th>
      <th>388</th>
      <th>389</th>
      <th>...</th>
      <th>771</th>
      <th>772</th>
      <th>773</th>
      <th>774</th>
      <th>775</th>
      <th>776</th>
      <th>777</th>
      <th>778</th>
      <th>779</th>
      <th>780</th>
    </tr>
    <tr>
      <th>Primary</th>
      <th>Setting</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">0</th>
      <th>0</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>65</th>
      <td>0.000008</td>
      <td>0.000009</td>
      <td>9.745215e-06</td>
      <td>0.000009</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000005</td>
      <td>...</td>
      <td>0.000009</td>
      <td>0.000008</td>
      <td>0.000011</td>
      <td>0.000011</td>
      <td>0.000011</td>
      <td>4.776394e-06</td>
      <td>3.671169e-06</td>
      <td>8.690441e-07</td>
      <td>2.504634e-07</td>
      <td>2.539856e-07</td>
    </tr>
    <tr>
      <th>130</th>
      <td>0.000010</td>
      <td>0.000011</td>
      <td>1.202408e-05</td>
      <td>0.000014</td>
      <td>0.000022</td>
      <td>0.000016</td>
      <td>0.000013</td>
      <td>0.000012</td>
      <td>0.000014</td>
      <td>0.000013</td>
      <td>...</td>
      <td>0.000003</td>
      <td>0.000003</td>
      <td>0.000003</td>
      <td>0.000002</td>
      <td>0.000000</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
      <td>4.140402e-06</td>
      <td>4.181861e-06</td>
      <td>4.240670e-06</td>
    </tr>
    <tr>
      <th>195</th>
      <td>0.000004</td>
      <td>0.000004</td>
      <td>6.014049e-07</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000012</td>
      <td>0.000013</td>
      <td>0.000013</td>
      <td>0.000014</td>
      <td>0.000014</td>
      <td>7.684585e-07</td>
      <td>7.781628e-07</td>
      <td>1.842077e-07</td>
      <td>0.000000e+00</td>
      <td>0.000000e+00</td>
    </tr>
    <tr>
      <th>260</th>
      <td>0.000023</td>
      <td>0.000012</td>
      <td>0.000000e+00</td>
      <td>0.000004</td>
      <td>0.000007</td>
      <td>0.000012</td>
      <td>0.000011</td>
      <td>0.000016</td>
      <td>0.000040</td>
      <td>0.000049</td>
      <td>...</td>
      <td>0.000007</td>
      <td>0.000006</td>
      <td>0.000006</td>
      <td>0.000006</td>
      <td>0.000012</td>
      <td>1.513954e-05</td>
      <td>1.252247e-05</td>
      <td>1.269276e-05</td>
      <td>1.281985e-05</td>
      <td>7.991981e-06</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">9</th>
      <th>3835</th>
      <td>0.001902</td>
      <td>0.001782</td>
      <td>1.386320e-03</td>
      <td>0.001362</td>
      <td>0.001630</td>
      <td>0.001647</td>
      <td>0.001160</td>
      <td>0.001866</td>
      <td>0.002541</td>
      <td>0.002595</td>
      <td>...</td>
      <td>0.000592</td>
      <td>0.000573</td>
      <td>0.000521</td>
      <td>0.000807</td>
      <td>0.000618</td>
      <td>6.720443e-04</td>
      <td>7.648245e-04</td>
      <td>7.677751e-04</td>
      <td>9.100419e-04</td>
      <td>8.549128e-04</td>
    </tr>
    <tr>
      <th>3900</th>
      <td>0.001471</td>
      <td>0.001634</td>
      <td>2.300030e-03</td>
      <td>0.002383</td>
      <td>0.002145</td>
      <td>0.001927</td>
      <td>0.001556</td>
      <td>0.001704</td>
      <td>0.001555</td>
      <td>0.001717</td>
      <td>...</td>
      <td>0.000697</td>
      <td>0.000772</td>
      <td>0.000568</td>
      <td>0.000602</td>
      <td>0.000595</td>
      <td>5.869208e-04</td>
      <td>6.342476e-04</td>
      <td>6.455188e-04</td>
      <td>6.345751e-04</td>
      <td>7.664858e-04</td>
    </tr>
    <tr>
      <th>3965</th>
      <td>0.002061</td>
      <td>0.002297</td>
      <td>2.212991e-03</td>
      <td>0.002499</td>
      <td>0.002516</td>
      <td>0.002555</td>
      <td>0.001571</td>
      <td>0.001244</td>
      <td>0.001204</td>
      <td>0.001470</td>
      <td>...</td>
      <td>0.001060</td>
      <td>0.000784</td>
      <td>0.000770</td>
      <td>0.000743</td>
      <td>0.000430</td>
      <td>4.897906e-04</td>
      <td>5.161750e-04</td>
      <td>7.753686e-04</td>
      <td>8.782367e-04</td>
      <td>1.083818e-03</td>
    </tr>
    <tr>
      <th>4030</th>
      <td>0.001751</td>
      <td>0.001866</td>
      <td>1.807109e-03</td>
      <td>0.001662</td>
      <td>0.001164</td>
      <td>0.001096</td>
      <td>0.000952</td>
      <td>0.001110</td>
      <td>0.001482</td>
      <td>0.000940</td>
      <td>...</td>
      <td>0.000766</td>
      <td>0.000729</td>
      <td>0.000841</td>
      <td>0.000865</td>
      <td>0.000874</td>
      <td>6.683831e-04</td>
      <td>6.569512e-04</td>
      <td>5.133820e-04</td>
      <td>6.889034e-04</td>
      <td>7.533813e-04</td>
    </tr>
    <tr>
      <th>4095</th>
      <td>0.000900</td>
      <td>0.001126</td>
      <td>1.366911e-03</td>
      <td>0.001139</td>
      <td>0.001264</td>
      <td>0.001266</td>
      <td>0.001387</td>
      <td>0.001376</td>
      <td>0.001575</td>
      <td>0.001608</td>
      <td>...</td>
      <td>0.000870</td>
      <td>0.000711</td>
      <td>0.000722</td>
      <td>0.000771</td>
      <td>0.000855</td>
      <td>9.470399e-04</td>
      <td>9.109968e-04</td>
      <td>1.216197e-03</td>
      <td>1.373307e-03</td>
      <td>1.450729e-03</td>
    </tr>
  </tbody>
</table>
<p>640 rows × 401 columns</p>
</div></div>
</div>
<p>If a device is known to be perfectly linear it would suffice to include measurements for each primary at only the minimum and maximum setting. But digital light devices are rarely linear, so to ensure an accurate device model one should include multiple measurements for each primary across the input range. In this case there are 64 measurements for each of the 10 primaries, evenly spaced across the input range.</p>
</section>
<section id="Visualising-calibration-data">
<h2>Visualising calibration data<a class="headerlink" href="#Visualising-calibration-data" title="Permalink to this heading">¶</a></h2>
<p><code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code> has some useful methods for visualising calibration data. <code class="docutils literal notranslate"><span class="pre">.plot_calibration_spds_and_gamut(...)</span></code> will plot the calibration measurements alongside the <em>xy</em> chromaticity coordinates of each channel at maximum.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">plot_calibration_spds_and_gamut</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_8_0.png" src="_images/03b_stimulation_devices_8_0.png" />
</div>
</div>
<p>By default, <code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code> incorporates the the <a class="reference external" href="https://cie.co.at/news/cie-s-0262018-tutorial">CIE026</a> photoreceptor action spectra, which are estimates of the spectral sensitivity of retinal photoreceptors. The action spectra are used internally to calculate <em>a</em>-opic irradiance, which is the ammount of light ‘seen’ by individual photoreceptors.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">fig</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">observer</span><span class="o">.</span><span class="n">plot_action_spectra</span><span class="p">(</span><span class="n">figsize</span><span class="o">=</span><span class="p">(</span><span class="mf">7.08</span><span class="p">,</span> <span class="mi">3</span><span class="p">))</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_10_0.png" src="_images/03b_stimulation_devices_10_0.png" />
</div>
</div>
</section>
<section id="Dealing-with-non-linearity">
<h2>Dealing with non-linearity<a class="headerlink" href="#Dealing-with-non-linearity" title="Permalink to this heading">¶</a></h2>
<p>Digital light-producing devices tend not to have a linear relationship between requested input and spectral output. On standard computer monitors this is often referred to as a <em>gamma function</em>, and often you will hear of a computer monitor being gamma corrected or linearized, which typically involves reversing a function fitted to the data to find the input values needed to achieve linear output.</p>
<p><code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code> includes a <code class="docutils literal notranslate"><span class="pre">.do_gamma()</span></code> method that characterises the linearity of each device primary with reverse <a class="reference external" href="https://en.wikipedia.org/wiki/Beta_distribution">beta cumulative distribution function</a> or <a class="reference external" href="https://en.wikipedia.org/wiki/Polynomial_regression">polynomial curve fits</a>. The interpolated results are saved in a lookup table that contains, for each requested input value, the actual value required to produce linear output.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span><span class="o">.</span><span class="n">do_gamma</span><span class="p">(</span><span class="n">fit</span><span class="o">=</span><span class="s1">&#39;polynomial&#39;</span><span class="p">,</span> <span class="n">poly_order</span><span class="o">=</span><span class="mi">7</span><span class="p">,</span> <span class="n">force_origin</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">gamma</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
      <th>5</th>
      <th>6</th>
      <th>7</th>
      <th>8</th>
      <th>9</th>
      <th>...</th>
      <th>4086</th>
      <th>4087</th>
      <th>4088</th>
      <th>4089</th>
      <th>4090</th>
      <th>4091</th>
      <th>4092</th>
      <th>4093</th>
      <th>4094</th>
      <th>4095</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>...</td>
      <td>4084</td>
      <td>4085</td>
      <td>4087</td>
      <td>4089</td>
      <td>4090</td>
      <td>4092</td>
      <td>4094</td>
      <td>4095</td>
      <td>4095</td>
      <td>4095</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>...</td>
      <td>4031</td>
      <td>4033</td>
      <td>4035</td>
      <td>4037</td>
      <td>4039</td>
      <td>4041</td>
      <td>4043</td>
      <td>4045</td>
      <td>4047</td>
      <td>4049</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>7</td>
      <td>...</td>
      <td>4084</td>
      <td>4085</td>
      <td>4085</td>
      <td>4086</td>
      <td>4086</td>
      <td>4087</td>
      <td>4087</td>
      <td>4088</td>
      <td>4088</td>
      <td>4089</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>7</td>
      <td>...</td>
      <td>4008</td>
      <td>4009</td>
      <td>4010</td>
      <td>4012</td>
      <td>4013</td>
      <td>4015</td>
      <td>4016</td>
      <td>4018</td>
      <td>4019</td>
      <td>4021</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>4</td>
      <td>6</td>
      <td>8</td>
      <td>9</td>
      <td>11</td>
      <td>13</td>
      <td>14</td>
      <td>...</td>
      <td>4063</td>
      <td>4063</td>
      <td>4064</td>
      <td>4065</td>
      <td>4066</td>
      <td>4066</td>
      <td>4067</td>
      <td>4068</td>
      <td>4069</td>
      <td>4070</td>
    </tr>
    <tr>
      <th>5</th>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>5</td>
      <td>6</td>
      <td>8</td>
      <td>10</td>
      <td>11</td>
      <td>13</td>
      <td>15</td>
      <td>...</td>
      <td>4077</td>
      <td>4078</td>
      <td>4079</td>
      <td>4079</td>
      <td>4080</td>
      <td>4081</td>
      <td>4081</td>
      <td>4082</td>
      <td>4083</td>
      <td>4084</td>
    </tr>
    <tr>
      <th>6</th>
      <td>0</td>
      <td>1</td>
      <td>3</td>
      <td>5</td>
      <td>6</td>
      <td>8</td>
      <td>10</td>
      <td>11</td>
      <td>13</td>
      <td>15</td>
      <td>...</td>
      <td>4053</td>
      <td>4054</td>
      <td>4055</td>
      <td>4056</td>
      <td>4057</td>
      <td>4057</td>
      <td>4058</td>
      <td>4059</td>
      <td>4060</td>
      <td>4061</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0</td>
      <td>2</td>
      <td>4</td>
      <td>7</td>
      <td>9</td>
      <td>12</td>
      <td>14</td>
      <td>17</td>
      <td>19</td>
      <td>22</td>
      <td>...</td>
      <td>4068</td>
      <td>4068</td>
      <td>4069</td>
      <td>4070</td>
      <td>4070</td>
      <td>4071</td>
      <td>4072</td>
      <td>4072</td>
      <td>4073</td>
      <td>4074</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>6</td>
      <td>...</td>
      <td>4006</td>
      <td>4008</td>
      <td>4011</td>
      <td>4013</td>
      <td>4016</td>
      <td>4018</td>
      <td>4021</td>
      <td>4023</td>
      <td>4026</td>
      <td>4029</td>
    </tr>
    <tr>
      <th>9</th>
      <td>0</td>
      <td>0</td>
      <td>1</td>
      <td>2</td>
      <td>3</td>
      <td>4</td>
      <td>5</td>
      <td>6</td>
      <td>7</td>
      <td>8</td>
      <td>...</td>
      <td>4018</td>
      <td>4019</td>
      <td>4021</td>
      <td>4022</td>
      <td>4023</td>
      <td>4024</td>
      <td>4026</td>
      <td>4027</td>
      <td>4028</td>
      <td>4030</td>
    </tr>
  </tbody>
</table>
<p>10 rows × 4096 columns</p>
</div></div>
</div>
<p>The gamma table can now be used to linearise the device. Let’s plot the gamma results for each primary and show the corrected values.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span><span class="o">.</span><span class="n">plot_gamma</span><span class="p">(</span><span class="n">show_corrected</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_0.png" src="_images/03b_stimulation_devices_15_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_1.png" src="_images/03b_stimulation_devices_15_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_2.png" src="_images/03b_stimulation_devices_15_2.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_3.png" src="_images/03b_stimulation_devices_15_3.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_4.png" src="_images/03b_stimulation_devices_15_4.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_5.png" src="_images/03b_stimulation_devices_15_5.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_6.png" src="_images/03b_stimulation_devices_15_6.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_7.png" src="_images/03b_stimulation_devices_15_7.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_8.png" src="_images/03b_stimulation_devices_15_8.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_15_9.png" src="_images/03b_stimulation_devices_15_9.png" />
</div>
</div>
</section>
<section id="Predicting-spectral-output">
<h2>Predicting spectral output<a class="headerlink" href="#Predicting-spectral-output" title="Permalink to this heading">¶</a></h2>
<p>The spectral output for a chosen primary at a given setting can be predicted with the <code class="docutils literal notranslate"><span class="pre">.predict_primary_spd(...)</span></code> method. This method simply interpolates between the measured spectra provided in the calibration data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">primary_spd</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">predict_primary_spd</span><span class="p">(</span>
    <span class="n">primary</span><span class="o">=</span><span class="mi">2</span><span class="p">,</span>
    <span class="n">primary_input</span><span class="o">=</span><span class="mf">.5</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Primary 2 (half power)&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">primary_spd</span><span class="p">)</span>
<span class="n">primary_spd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span><span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;W/m$^2$/nm&#39;</span><span class="p">,</span> <span class="n">c</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">primary_colors</span><span class="p">[</span><span class="mi">2</span><span class="p">],</span> <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">);</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Wavelength
380    0.000356
381    0.000329
382    0.000395
383    0.000438
384    0.000370
         ...
776    0.000138
777    0.000124
778    0.000126
779    0.000112
780    0.000138
Name: Primary 2 (half power), Length: 401, dtype: float64
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_18_1.png" src="_images/03b_stimulation_devices_18_1.png" />
</div>
</div>
<p>One can also predict the spectral output for a combination of primaries and settings with <code class="docutils literal notranslate"><span class="pre">.predict_multiprimary_spd(...)</span></code>. This method calls the previous method for each primary/setting pair and sums the spectral power distributions.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[8]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">all_primaries_half_max</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span><span class="p">]</span> <span class="o">*</span> <span class="n">device</span><span class="o">.</span><span class="n">nprimaries</span>

<span class="n">half_max_spd</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">predict_multiprimary_spd</span><span class="p">(</span>
    <span class="n">multiprimary_input</span><span class="o">=</span><span class="n">all_primaries_half_max</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;All channels at half max&#39;</span>
<span class="p">)</span>

<span class="n">half_max_spd</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">legend</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;W/m$^2$/nm&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="s1">&#39;k&#39;</span>
<span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicted spectral output for device settings:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">all_primaries_half_max</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">half_max_spd</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Predicted spectral output for device settings:
 [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]

Wavelength
380    0.007696
381    0.008681
382    0.009253
383    0.009193
384    0.008020
         ...
776    0.007136
777    0.007279
778    0.007225
779    0.006890
780    0.006819
Name: All channels at half max, Length: 401, dtype: float64
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_20_1.png" src="_images/03b_stimulation_devices_20_1.png" />
</div>
</div>
<p>One can calculate <em>a</em>-opic irradiance with the <code class="docutils literal notranslate"><span class="pre">.predict_multiprimary_aopic(...)</span></code> method, which weights a predicted spectrum by the action spectrum for each photoreceptor.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[9]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">half_max_aopic</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">predict_multiprimary_aopic</span><span class="p">(</span>
    <span class="n">multiprimary_input</span><span class="o">=</span><span class="n">all_primaries_half_max</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;Half max $a$-opic&#39;</span>
<span class="p">)</span>

<span class="n">half_max_aopic</span><span class="o">.</span><span class="n">plot</span><span class="p">(</span>
    <span class="n">kind</span><span class="o">=</span><span class="s1">&#39;bar&#39;</span><span class="p">,</span>
    <span class="n">color</span><span class="o">=</span><span class="n">device</span><span class="o">.</span><span class="n">observer</span><span class="o">.</span><span class="n">photoreceptor_colors</span><span class="o">.</span><span class="n">values</span><span class="p">(),</span>
    <span class="n">ylabel</span><span class="o">=</span><span class="s1">&#39;W/m$^2$&#39;</span><span class="p">,</span>
    <span class="n">rot</span><span class="o">=</span><span class="mi">0</span>
<span class="p">)</span>

<span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;Predicted a-opic irradiance for device settings:</span><span class="se">\n</span><span class="s1"> </span><span class="si">{</span><span class="n">all_primaries_half_max</span><span class="si">}</span><span class="se">\n</span><span class="s1">&#39;</span><span class="p">)</span>
<span class="nb">print</span><span class="p">(</span><span class="n">half_max_aopic</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Predicted a-opic irradiance for device settings:
 [0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5, 0.5]

sc     22.990637
mc     40.281301
lc     49.550207
rh     38.653506
mel    34.985300
Name: Half max $a$-opic, dtype: float64
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_22_1.png" src="_images/03b_stimulation_devices_22_1.png" />
</div>
</div>
</section>
<section id="Settings-vs. weights">
<h2>Settings vs. weights<a class="headerlink" href="#Settings-vs. weights" title="Permalink to this heading">¶</a></h2>
<p>When predicting device output, one can use device settings in the native resolution or floating point weights between 0-1. The latter are used internally for convenience and precision, but one can convert back and forth between settings and weights with the <code class="docutils literal notranslate"><span class="pre">.s2w(...)</span></code> and <code class="docutils literal notranslate"><span class="pre">.w2s(...)</span></code> methods.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="p">[</span><span class="mi">2047</span><span class="p">]</span> <span class="o">*</span> <span class="n">device</span><span class="o">.</span><span class="n">nprimaries</span>
<span class="n">settings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[10]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[2047, 2047, 2047, 2047, 2047, 2047, 2047, 2047, 2047, 2047]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert settings to weights</span>
<span class="n">weights</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">s2w</span><span class="p">(</span><span class="n">settings</span><span class="p">)</span>
<span class="n">weights</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[11]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999,
 0.4998778998778999]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Convert back to settings</span>
<span class="n">settings</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">w2s</span><span class="p">(</span><span class="n">weights</span><span class="p">)</span>
<span class="n">settings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[12]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[2047, 2047, 2047, 2047, 2047, 2047, 2047, 2047, 2047, 2047]
</pre></div></div>
</div>
</section>
<section id="Finding-a-target-spectrum">
<h2>Finding a target spectrum<a class="headerlink" href="#Finding-a-target-spectrum" title="Permalink to this heading">¶</a></h2>
<p>If you need to find a spectrum with a specific chromaticity and luminance, you can use <code class="docutils literal notranslate"><span class="pre">.find_Settings_xyY(...)</span></code>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[13]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_xy</span><span class="o">=</span><span class="p">[</span><span class="mf">0.31271</span><span class="p">,</span> <span class="mf">0.32902</span><span class="p">]</span>
<span class="n">target_luminance</span><span class="o">=</span><span class="mf">6000.</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">find_settings_xyY</span><span class="p">(</span><span class="n">target_xy</span><span class="p">,</span> <span class="n">target_luminance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
basinhopping step 0: f 0.618782
basinhopping step 1: f 0.11714 trial_f 0.11714 accepted 1  lowest_f 0.11714
found new global minimum on step 1 with function value 0.11714
basinhopping step 2: f 4.76585e-08 trial_f 4.76585e-08 accepted 1  lowest_f 4.76585e-08
found new global minimum on step 2 with function value 4.76585e-08
Requested LMS: L    8.737379
M    7.810517
S    4.455637
dtype: float64
Solution LMS: [ 8.73754327  7.81047938  4.45549767]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_29_1.png" src="_images/03b_stimulation_devices_29_1.png" />
</div>
</div>
<p><code class="docutils literal notranslate"><span class="pre">.find_settings_xyY(...)</span></code> returns an <code class="docutils literal notranslate"><span class="pre">OptimisationResult</span></code> from <code class="docutils literal notranslate"><span class="pre">SciPy</span></code>. To have your device produce this spectrum, you will need to convert the result to the native resolution before plugging them in.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">settings</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">w2s</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="n">settings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[884, 56, 148, 430, 1339, 313, 368, 0, 0, 4095]
</pre></div></div>
</div>
</section>
<section id="Making-a-configuration-file">
<h2>Making a configuration file<a class="headerlink" href="#Making-a-configuration-file" title="Permalink to this heading">¶</a></h2>
<p>When working with different devices or calibration files it may be more convenient to instantiate <code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code> from a json configuration file using the <code class="docutils literal notranslate"><span class="pre">.from_json(...)</span></code> constructor. Here is an example configuration script to generate a json file with the required arguments.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">json</span>


<span class="c1"># Configure device</span>
<span class="n">CALIBRATION</span> <span class="o">=</span> <span class="s2">&quot;/Users/jtm545/Projects/PySilSub/pysilsub/data/ProPixx.csv&quot;</span>
<span class="n">CALIBRATION_WAVELENGTHS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">380</span><span class="p">,</span> <span class="mi">781</span><span class="p">,</span> <span class="mi">1</span><span class="p">]</span>
<span class="n">PRIMARY_RESOLUTIONS</span> <span class="o">=</span> <span class="p">[</span><span class="mi">255</span><span class="p">]</span> <span class="o">*</span> <span class="mi">3</span>
<span class="n">PRIMARY_COLORS</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;red&quot;</span><span class="p">,</span> <span class="s2">&quot;green&quot;</span><span class="p">,</span> <span class="s2">&quot;blue&quot;</span><span class="p">]</span>
<span class="n">CALIBRATION_UNITS</span> <span class="o">=</span> <span class="s2">&quot;Counts/s/nm&quot;</span>
<span class="n">NAME</span> <span class="o">=</span> <span class="s2">&quot;ProPixx Projector&quot;</span>
<span class="n">JSON_NAME</span> <span class="o">=</span> <span class="s2">&quot;ProPixx&quot;</span>
<span class="n">NOTES</span> <span class="o">=</span> <span class="p">(</span>
    <span class="s2">&quot;VPixx ProPixx projector at the York Neuroimaging Center. Spectra were &quot;</span>
    <span class="s2">&quot;measured with an OceanOptics Jaz spectrometer using a long fiber optic &quot;</span>
    <span class="s2">&quot;cable.&quot;</span>
<span class="p">)</span>


<span class="k">def</span> <span class="nf">device_config</span><span class="p">():</span>

    <span class="n">config</span> <span class="o">=</span> <span class="p">{</span>
        <span class="s2">&quot;calibration&quot;</span><span class="p">:</span> <span class="n">CALIBRATION</span><span class="p">,</span>
        <span class="s2">&quot;calibration_wavelengths&quot;</span><span class="p">:</span> <span class="n">CALIBRATION_WAVELENGTHS</span><span class="p">,</span>
        <span class="s2">&quot;primary_resolutions&quot;</span><span class="p">:</span> <span class="n">PRIMARY_RESOLUTIONS</span><span class="p">,</span>
        <span class="s2">&quot;primary_colors&quot;</span><span class="p">:</span> <span class="n">PRIMARY_COLORS</span><span class="p">,</span>
        <span class="s2">&quot;name&quot;</span><span class="p">:</span> <span class="n">NAME</span><span class="p">,</span>
        <span class="s2">&quot;calibration_units&quot;</span><span class="p">:</span> <span class="n">CALIBRATION_UNITS</span><span class="p">,</span>
        <span class="s2">&quot;json_name&quot;</span><span class="p">:</span> <span class="n">JSON_NAME</span><span class="p">,</span>
        <span class="s2">&quot;notes&quot;</span><span class="p">:</span> <span class="n">NOTES</span><span class="p">,</span>
    <span class="p">}</span>

    <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">open</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;../../pysilsub/data/</span><span class="si">{</span><span class="n">JSON_NAME</span><span class="si">}</span><span class="s2">.json&quot;</span><span class="p">,</span> <span class="s2">&quot;w&quot;</span><span class="p">),</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">device_config</span><span class="p">()</span>
<br/></pre></div>
</div>
</div>
<p>Now we can instantiate from the json file.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">device</span> <span class="o">=</span> <span class="n">StimulationDevice</span><span class="o">.</span><span class="n">from_json</span><span class="p">(</span><span class="s1">&#39;../../pysilsub/data/ProPixx.json&#39;</span><span class="p">)</span>
<span class="n">device</span><span class="o">.</span><span class="n">config</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[16]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
{&#39;calibration&#39;: &#39;/Users/jtm545/Projects/PySilSub/pysilsub/data/ProPixx.csv&#39;,
 &#39;calibration_wavelengths&#39;: [380, 781, 1],
 &#39;primary_resolutions&#39;: [255, 255, 255],
 &#39;primary_colors&#39;: [&#39;red&#39;, &#39;green&#39;, &#39;blue&#39;],
 &#39;name&#39;: &#39;ProPixx Projector&#39;,
 &#39;calibration_units&#39;: &#39;Counts/s/nm&#39;,
 &#39;json_name&#39;: &#39;ProPixx&#39;,
 &#39;notes&#39;: &#39;VPixx ProPixx projector at the York Neuroimaging Center. Spectra were measured with an OceanOptics Jaz spectrometer using a long fiber optic cable.&#39;}
</pre></div></div>
</div>
</section>
<section id="Package-data">
<h2>Package data<a class="headerlink" href="#Package-data" title="Permalink to this heading">¶</a></h2>
<p><em>PySilSub</em> comes with calibration and configuration data for various multiprimary stimulation systems. This means you can experiment with the package without having to calibrate and configure your own system.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">available</span> <span class="o">=</span> <span class="n">StimulationDevice</span><span class="o">.</span><span class="n">show_package_data</span><span class="p">(</span><span class="n">verbose</span><span class="o">=</span><span class="kc">False</span><span class="p">)</span>
<span class="n">available</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[14]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[&#39;STLAB_2_York&#39;,
 &#39;OneLight&#39;,
 &#39;CRT&#39;,
 &#39;ProPixx&#39;,
 &#39;BCGAR&#39;,
 &#39;VirtualSky&#39;,
 &#39;STLAB_1_York&#39;]
</pre></div></div>
</div>
<p>One can easily create a <code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code> from example package data.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[15]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pprint</span> <span class="kn">import</span> <span class="n">pprint</span>

<span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="p">[</span><span class="s1">&#39;STLAB_1_York&#39;</span><span class="p">,</span> <span class="s1">&#39;OneLight&#39;</span><span class="p">,</span> <span class="s1">&#39;ProPixx&#39;</span><span class="p">,</span> <span class="s1">&#39;VirtualSky&#39;</span><span class="p">]:</span>
    <span class="n">device</span> <span class="o">=</span> <span class="n">StimulationDevice</span><span class="o">.</span><span class="n">from_package_data</span><span class="p">(</span><span class="n">device</span><span class="p">)</span>
    <span class="n">fig</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">plot_calibration_spds_and_gamut</span><span class="p">(</span><span class="n">spd_kwargs</span><span class="o">=</span><span class="p">{</span><span class="s1">&#39;legend&#39;</span><span class="p">:</span><span class="kc">False</span><span class="p">})</span>
<br/></pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_39_0.png" src="_images/03b_stimulation_devices_39_0.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_39_1.png" src="_images/03b_stimulation_devices_39_1.png" />
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_39_2.png" src="_images/03b_stimulation_devices_39_2.png" />
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_stimulation_devices_39_3.png" src="_images/03b_stimulation_devices_39_3.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/photoreceptor_characters.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">PySilSub</a></h1>



<p class="blurb">A Python toolbox for performing the method of silent substitution.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=PySilentSubstitution&repo=pysilsub&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="03_overview.html">Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="03a_colorimetric_observers.html">Colorimetric observer models</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Stimulation devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="03c_silent_substitution_problems.html">Silent substitution problems</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="05_examples.html">Examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_api.html">API Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="07_project_notes.html">Project notes</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_contributors.html">Contributors</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="11_citation.html">Citation</a></li>
</ul>


<hr />
<ul>
    
    <li class="toctree-l1"><a href="https://pypi.org/project/pysilsub/">PyPi</a></li>
    
    <li class="toctree-l1"><a href="https://jov.arvojournals.org/article.aspx?articleid=2791309">Paper</a></li>
    
</ul>
<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="03_overview.html">Overview</a><ul>
      <li>Previous: <a href="03a_colorimetric_observers.html" title="previous chapter">Colorimetric observer models</a></li>
      <li>Next: <a href="03c_silent_substitution_problems.html" title="next chapter">Silent substitution problems</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>document.getElementById('searchbox').style.display = "block"</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Joel T. Martin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 5.0.2</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/03b_stimulation_devices.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>