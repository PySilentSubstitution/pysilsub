
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Stimulation devices &#8212; PySilSub 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script async="async" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Stimulus problems" href="03b_stimulus_problems.html" />
    <link rel="prev" title="Overview" href="03_overview.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Stimulation-devices">
<h1>Stimulation devices<a class="headerlink" href="#Stimulation-devices" title="Permalink to this headline">¶</a></h1>
<p>To stimulate one class of retinal photoreceptor without changing the activation in others—which is to perform the method of silent substitution—requires a multiprimary stimulation device with at least as many primaries as there are photoreceptors on the retina. This generally means that <a class="reference internal" href="01_background.html"><span class="doc">5 primaries are needed</span></a>, although 4 primaries may suffice when working in the photopic range as rod photoreceptors become saturated and incapable of signalling above 300 cd/m<span class="math notranslate nohighlight">\(^2\)</span>
(<a class="reference external" href="https://doi.org/10.1080/713818657">Aguiller and Stiles, 1954</a>; but see <a class="reference external" href="https://iovs.arvojournals.org/article.aspx?articleid=2200107">Shapiro, 2002</a>; <a class="reference external" href="https://doi.org/10.1007/s10633-008-9159-0">Kremers et al., 2009</a>). The primaries should be independantly addressable, additive, narrowband, and ideally stable over time with a linear gamma function. The light source should also be integrated into an optical system for stimulus delivery, which is usually a full field ganzfeld stimulator
(e.g., <a class="reference external" href="https://doi.org/10.3758/s13428-021-01759-3">Martin et al., 2021</a>) or a maxwellian setup (e.g., <a class="reference external" href="https://doi.org/10.1167/15.1.27">Cao et al., 2015</a>).</p>
<p><a class="reference external" href="https://doi.org/10.3390/photonics7040121">Conus and Geiser (2020)</a> reviewed the stimulation devices from a range of silent substitution studies and found that in most cases the device had 4 or 5 primaries and was built from scratch using LEDs, optical bench components, and microprocessors, such as Arduino, for pulse width modulation control of brightness. Regardless of the device that is used, an external calibration with a spectrometer is necessary, and that is where <em>PySilSub</em> becomes
useful.</p>
<section id="pysilsub.device.StimulationDevice">
<h2><code class="docutils literal notranslate"><span class="pre">pysilsub.device.StimulationDevice</span></code><a class="headerlink" href="#pysilsub.device.StimulationDevice" title="Permalink to this headline">¶</a></h2>
<p><em>PySilSub</em> has a <code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code> class which provides generic support for multiprimary devices integrated into an optical stimulation setup. The starting point is a calibration file with spectral measurements</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="n">data</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span><span class="s1">&#39;../../data/RGBA_linear_artificial.csv&#39;</span><span class="p">,</span>
                   <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Primary&#39;</span><span class="p">,</span> <span class="s1">&#39;Setting&#39;</span><span class="p">])</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="s1">&#39;int64&#39;</span><span class="p">)</span>
<span class="n">data</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Wavelength&#39;</span>
<span class="n">data</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Wavelength</th>
      <th>380</th>
      <th>381</th>
      <th>382</th>
      <th>383</th>
      <th>384</th>
      <th>385</th>
      <th>386</th>
      <th>387</th>
      <th>388</th>
      <th>389</th>
      <th>...</th>
      <th>771</th>
      <th>772</th>
      <th>773</th>
      <th>774</th>
      <th>775</th>
      <th>776</th>
      <th>777</th>
      <th>778</th>
      <th>779</th>
      <th>780</th>
    </tr>
    <tr>
      <th>Primary</th>
      <th>Setting</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">0</th>
      <th>0</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>8</th>
      <td>0.000053</td>
      <td>0.000058</td>
      <td>0.000052</td>
      <td>0.000052</td>
      <td>0.000046</td>
      <td>0.000044</td>
      <td>0.000050</td>
      <td>0.000033</td>
      <td>0.000052</td>
      <td>0.000058</td>
      <td>...</td>
      <td>0.000029</td>
      <td>0.000032</td>
      <td>0.000032</td>
      <td>0.000032</td>
      <td>0.000035</td>
      <td>0.000033</td>
      <td>0.000033</td>
      <td>0.000025</td>
      <td>0.000034</td>
      <td>0.000035</td>
    </tr>
    <tr>
      <th>16</th>
      <td>0.000107</td>
      <td>0.000116</td>
      <td>0.000104</td>
      <td>0.000103</td>
      <td>0.000093</td>
      <td>0.000088</td>
      <td>0.000100</td>
      <td>0.000065</td>
      <td>0.000105</td>
      <td>0.000115</td>
      <td>...</td>
      <td>0.000058</td>
      <td>0.000064</td>
      <td>0.000064</td>
      <td>0.000065</td>
      <td>0.000069</td>
      <td>0.000066</td>
      <td>0.000065</td>
      <td>0.000050</td>
      <td>0.000067</td>
      <td>0.000070</td>
    </tr>
    <tr>
      <th>24</th>
      <td>0.000160</td>
      <td>0.000174</td>
      <td>0.000157</td>
      <td>0.000155</td>
      <td>0.000139</td>
      <td>0.000133</td>
      <td>0.000150</td>
      <td>0.000098</td>
      <td>0.000157</td>
      <td>0.000173</td>
      <td>...</td>
      <td>0.000087</td>
      <td>0.000097</td>
      <td>0.000096</td>
      <td>0.000097</td>
      <td>0.000104</td>
      <td>0.000100</td>
      <td>0.000098</td>
      <td>0.000074</td>
      <td>0.000101</td>
      <td>0.000104</td>
    </tr>
    <tr>
      <th>32</th>
      <td>0.000213</td>
      <td>0.000232</td>
      <td>0.000209</td>
      <td>0.000206</td>
      <td>0.000186</td>
      <td>0.000177</td>
      <td>0.000200</td>
      <td>0.000130</td>
      <td>0.000209</td>
      <td>0.000231</td>
      <td>...</td>
      <td>0.000116</td>
      <td>0.000129</td>
      <td>0.000128</td>
      <td>0.000129</td>
      <td>0.000138</td>
      <td>0.000133</td>
      <td>0.000131</td>
      <td>0.000099</td>
      <td>0.000134</td>
      <td>0.000139</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">3</th>
      <th>224</th>
      <td>0.003027</td>
      <td>0.003555</td>
      <td>0.003159</td>
      <td>0.003563</td>
      <td>0.002712</td>
      <td>0.002951</td>
      <td>0.002827</td>
      <td>0.002159</td>
      <td>0.003197</td>
      <td>0.003623</td>
      <td>...</td>
      <td>0.001990</td>
      <td>0.002227</td>
      <td>0.002264</td>
      <td>0.002182</td>
      <td>0.002558</td>
      <td>0.002361</td>
      <td>0.002268</td>
      <td>0.001905</td>
      <td>0.002162</td>
      <td>0.002360</td>
    </tr>
    <tr>
      <th>232</th>
      <td>0.003135</td>
      <td>0.003682</td>
      <td>0.003271</td>
      <td>0.003690</td>
      <td>0.002808</td>
      <td>0.003056</td>
      <td>0.002928</td>
      <td>0.002237</td>
      <td>0.003311</td>
      <td>0.003753</td>
      <td>...</td>
      <td>0.002061</td>
      <td>0.002306</td>
      <td>0.002345</td>
      <td>0.002259</td>
      <td>0.002649</td>
      <td>0.002446</td>
      <td>0.002349</td>
      <td>0.001973</td>
      <td>0.002239</td>
      <td>0.002445</td>
    </tr>
    <tr>
      <th>240</th>
      <td>0.003243</td>
      <td>0.003809</td>
      <td>0.003384</td>
      <td>0.003817</td>
      <td>0.002905</td>
      <td>0.003162</td>
      <td>0.003029</td>
      <td>0.002314</td>
      <td>0.003426</td>
      <td>0.003882</td>
      <td>...</td>
      <td>0.002132</td>
      <td>0.002386</td>
      <td>0.002426</td>
      <td>0.002337</td>
      <td>0.002741</td>
      <td>0.002530</td>
      <td>0.002430</td>
      <td>0.002041</td>
      <td>0.002316</td>
      <td>0.002529</td>
    </tr>
    <tr>
      <th>248</th>
      <td>0.003351</td>
      <td>0.003936</td>
      <td>0.003497</td>
      <td>0.003944</td>
      <td>0.003002</td>
      <td>0.003267</td>
      <td>0.003130</td>
      <td>0.002391</td>
      <td>0.003540</td>
      <td>0.004011</td>
      <td>...</td>
      <td>0.002203</td>
      <td>0.002465</td>
      <td>0.002507</td>
      <td>0.002415</td>
      <td>0.002832</td>
      <td>0.002614</td>
      <td>0.002511</td>
      <td>0.002109</td>
      <td>0.002394</td>
      <td>0.002613</td>
    </tr>
    <tr>
      <th>256</th>
      <td>0.003459</td>
      <td>0.004063</td>
      <td>0.003610</td>
      <td>0.004071</td>
      <td>0.003099</td>
      <td>0.003373</td>
      <td>0.003231</td>
      <td>0.002468</td>
      <td>0.003654</td>
      <td>0.004141</td>
      <td>...</td>
      <td>0.002274</td>
      <td>0.002545</td>
      <td>0.002587</td>
      <td>0.002493</td>
      <td>0.002923</td>
      <td>0.002699</td>
      <td>0.002592</td>
      <td>0.002177</td>
      <td>0.002471</td>
      <td>0.002698</td>
    </tr>
  </tbody>
</table>
<p>132 rows × 401 columns</p>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">silentsub.device</span> <span class="kn">import</span> <span class="n">StimulationDevice</span>

<span class="n">device</span> <span class="o">=</span> <span class="n">StimulationDevice</span><span class="p">(</span>
    <span class="n">resolutions</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">],</span>
    <span class="n">spds</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">spd_binwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;RGBA (8-bit, linear)&#39;</span>
<span class="p">)</span>

<span class="n">fig</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">plot_spds</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03a_stimulation_devices_3_0.png" src="_images/03a_stimulation_devices_3_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">target_xy</span><span class="o">=</span><span class="p">[</span><span class="mf">0.31271</span><span class="p">,</span> <span class="mf">0.32902</span><span class="p">]</span>  <span class="c1"># D65</span>
<span class="n">target_luminance</span><span class="o">=</span><span class="mf">600.</span>
<span class="n">bg</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">find_settings_xyY</span><span class="p">(</span><span class="n">target_xy</span><span class="p">,</span> <span class="n">target_luminance</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
basinhopping step 0: f 7.95618e-11
basinhopping step 1: f 6.40024e-08 trial_f 6.40024e-08 accepted 1  lowest_f 7.95618e-11
Requested LMS: [ 0.87374046  0.78105394  0.44556496]
Solution LMS: [ 0.87374198  0.78105108  0.44557328]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03a_stimulation_devices_4_1.png" src="_images/03a_stimulation_devices_4_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[47]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">silentsub.problem</span> <span class="kn">import</span> <span class="n">SilentSubstitutionProblem</span>

<span class="n">ss</span> <span class="o">=</span> <span class="n">SilentSubstitutionProblem</span><span class="p">(</span>
    <span class="n">resolutions</span><span class="o">=</span><span class="p">[</span><span class="mi">256</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span><span class="p">,</span>
    <span class="n">colors</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">],</span>
    <span class="n">spds</span><span class="o">=</span><span class="n">data</span><span class="p">,</span>
    <span class="n">spd_binwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="n">isolate</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span>
    <span class="n">silence</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;S&#39;</span><span class="p">]</span>
<span class="p">)</span>
<span class="n">_</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">plot_spds</span><span class="p">()</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03a_stimulation_devices_5_0.png" src="_images/03a_stimulation_devices_5_0.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[53]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">background</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span><span class="p">]</span><span class="o">*</span><span class="mi">4</span>
<span class="n">solution</span> <span class="o">=</span> <span class="n">ss</span><span class="o">.</span><span class="n">pseudo_inverse_contrast</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">background</span><span class="p">,</span> <span class="p">[</span><span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">.15</span><span class="p">])</span>
<span class="n">ss</span><span class="o">.</span><span class="n">debug_callback_plot</span><span class="p">(</span><span class="n">ss</span><span class="o">.</span><span class="n">background</span> <span class="o">+</span> <span class="n">solution</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
        {&#39;ignore&#39;: array([ 0.04204338]), &#39;silence&#39;: array([  1.17195941e-13,  -3.54556904e-14,  -1.22794788e-13]), &#39;isolate&#39;: array([ 0.04339031])}
        Background luminance: 8606.517702611187
        Modulation luminance: 8606.49680924542
        Background xy: [ 0.42657932  0.38791074]
        Modulation xy: [ 0.42657343  0.38791507]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03a_stimulation_devices_6_1.png" src="_images/03a_stimulation_devices_6_1.png" />
</div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ss</span><span class="o">.</span><span class="n">background</span><span class="o">+</span><span class="n">solution</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[33]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
array([ 0.59217207,  0.38386115,  0.57859024,  0.0023667 ])
</pre></div></div>
</div>
</section>
<section id="References">
<h2>References<a class="headerlink" href="#References" title="Permalink to this headline">¶</a></h2>
<ul class="simple">
<li><p>Aguilar, M., &amp; Stiles, W. S. (1954). Saturation of the rod mechanism of the retina at high levels of stimulation. Optica Acta: International Journal of Optics, 1(1), 59–65. <a class="reference external" href="https://doi.org/10.1080/713818657">https://doi.org/10.1080/713818657</a></p></li>
<li><p>Cao, D., Nicandro, N., &amp; Barrionuevo, P. A. (2015). A five-primary photostimulator suitable for studying intrinsically photosensitive retinal ganglion cell functions in humans. Journal of Vision, 15(1), 1–13. <a class="reference external" href="https://doi.org/10.1167/15.1.27">https://doi.org/10.1167/15.1.27</a></p></li>
<li><p>Conus, V., &amp; Geiser, M. (2020). A review of silent substitution devices for melanopsin stimulation in humans. Photonics, 7(4), 1–10. <a class="reference external" href="https://doi.org/10.3390/photonics7040121">https://doi.org/10.3390/photonics7040121</a></p></li>
</ul>
<ul class="simple">
<li><p>Geiser, M., Truffer, F., Balachandran, C., Kawasaki, A., &amp; Agrici, S. (2019). Device for silent substitution excitation of melanopsin for human eye. June, 36. <a class="reference external" href="https://doi.org/10.1117/12.2511654">https://doi.org/10.1117/12.2511654</a></p></li>
<li><p>Hexley, A. C., Özgür Yöntem, A., Spitschan, M., Smithson, H. E., &amp; Mantiuk, R. (2020). Demonstrating a multi-primary high dynamic range display system for vision experiments. Journal of the Optical Society of America A, 37(4), A271. <a class="reference external" href="https://doi.org/10.1364/josaa.384022">https://doi.org/10.1364/josaa.384022</a></p></li>
</ul>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/photoreceptor_characters.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">PySilSub</a></h1>



<p class="blurb">A Python software for performing the method of silent substitution.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=PySilentSubstitution&repo=silentsub&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="03_overview.html">Overview</a><ul class="current">
<li class="toctree-l2 current"><a class="current reference internal" href="#">Stimulation devices</a></li>
<li class="toctree-l2"><a class="reference internal" href="03b_stimulus_problems.html">Stimulus problems</a></li>
<li class="toctree-l2"><a class="reference internal" href="03c_linear_algebra.html">Linear algebra</a></li>
<li class="toctree-l2"><a class="reference internal" href="03d_numerical_optimization.html">Numerical optimization</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="05_examples.html">Worked examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_citation.html">Citation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="03_overview.html">Overview</a><ul>
      <li>Previous: <a href="03_overview.html" title="previous chapter">Overview</a></li>
      <li>Next: <a href="03b_stimulus_problems.html" title="next chapter">Stimulus problems</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2021, Joel T. Martin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.2.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/03a_stimulation_devices.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>