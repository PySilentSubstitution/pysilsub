
<!DOCTYPE html>

<html>
  <head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" /><meta name="generator" content="Docutils 0.17.1: http://docutils.sourceforge.net/" />

    <title>Making stimuli &#8212; PySilSub 0.0.1 documentation</title>
    <link rel="stylesheet" type="text/css" href="_static/pygments.css" />
    <link rel="stylesheet" type="text/css" href="_static/alabaster.css" />
    <script data-url_root="./" id="documentation_options" src="_static/documentation_options.js"></script>
    <script src="_static/jquery.js"></script>
    <script src="_static/underscore.js"></script>
    <script src="_static/doctools.js"></script>
    <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script>window.MathJax = {"tex": {"inlineMath": [["$", "$"], ["\\(", "\\)"]], "processEscapes": true}, "options": {"ignoreHtmlClass": "tex2jax_ignore|mathjax_ignore|document", "processHtmlClass": "tex2jax_process|mathjax_process|math|output_area"}}</script>
    <script defer="defer" src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Worked examples" href="05_examples.html" />
    <link rel="prev" title="Stimulation devices" href="03a_stimulation_devices.html" />
   
  <link rel="stylesheet" href="_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  

    <div class="document">
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  
<style>
/* CSS for nbsphinx extension */

/* remove conflicting styling from Sphinx themes */
div.nbinput.container div.prompt *,
div.nboutput.container div.prompt *,
div.nbinput.container div.input_area pre,
div.nboutput.container div.output_area pre,
div.nbinput.container div.input_area .highlight,
div.nboutput.container div.output_area .highlight {
    border: none;
    padding: 0;
    margin: 0;
    box-shadow: none;
}

div.nbinput.container > div[class*=highlight],
div.nboutput.container > div[class*=highlight] {
    margin: 0;
}

div.nbinput.container div.prompt *,
div.nboutput.container div.prompt * {
    background: none;
}

div.nboutput.container div.output_area .highlight,
div.nboutput.container div.output_area pre {
    background: unset;
}

div.nboutput.container div.output_area div.highlight {
    color: unset;  /* override Pygments text color */
}

/* avoid gaps between output lines */
div.nboutput.container div[class*=highlight] pre {
    line-height: normal;
}

/* input/output containers */
div.nbinput.container,
div.nboutput.container {
    display: -webkit-flex;
    display: flex;
    align-items: flex-start;
    margin: 0;
    width: 100%;
}
@media (max-width: 540px) {
    div.nbinput.container,
    div.nboutput.container {
        flex-direction: column;
    }
}

/* input container */
div.nbinput.container {
    padding-top: 5px;
}

/* last container */
div.nblast.container {
    padding-bottom: 5px;
}

/* input prompt */
div.nbinput.container div.prompt pre {
    color: #307FC1;
}

/* output prompt */
div.nboutput.container div.prompt pre {
    color: #BF5B3D;
}

/* all prompts */
div.nbinput.container div.prompt,
div.nboutput.container div.prompt {
    width: 4.5ex;
    padding-top: 5px;
    position: relative;
    user-select: none;
}

div.nbinput.container div.prompt > div,
div.nboutput.container div.prompt > div {
    position: absolute;
    right: 0;
    margin-right: 0.3ex;
}

@media (max-width: 540px) {
    div.nbinput.container div.prompt,
    div.nboutput.container div.prompt {
        width: unset;
        text-align: left;
        padding: 0.4em;
    }
    div.nboutput.container div.prompt.empty {
        padding: 0;
    }

    div.nbinput.container div.prompt > div,
    div.nboutput.container div.prompt > div {
        position: unset;
    }
}

/* disable scrollbars on prompts */
div.nbinput.container div.prompt pre,
div.nboutput.container div.prompt pre {
    overflow: hidden;
}

/* input/output area */
div.nbinput.container div.input_area,
div.nboutput.container div.output_area {
    -webkit-flex: 1;
    flex: 1;
    overflow: auto;
}
@media (max-width: 540px) {
    div.nbinput.container div.input_area,
    div.nboutput.container div.output_area {
        width: 100%;
    }
}

/* input area */
div.nbinput.container div.input_area {
    border: 1px solid #e0e0e0;
    border-radius: 2px;
    /*background: #f5f5f5;*/
}

/* override MathJax center alignment in output cells */
div.nboutput.container div[class*=MathJax] {
    text-align: left !important;
}

/* override sphinx.ext.imgmath center alignment in output cells */
div.nboutput.container div.math p {
    text-align: left;
}

/* standard error */
div.nboutput.container div.output_area.stderr {
    background: #fdd;
}

/* ANSI colors */
.ansi-black-fg { color: #3E424D; }
.ansi-black-bg { background-color: #3E424D; }
.ansi-black-intense-fg { color: #282C36; }
.ansi-black-intense-bg { background-color: #282C36; }
.ansi-red-fg { color: #E75C58; }
.ansi-red-bg { background-color: #E75C58; }
.ansi-red-intense-fg { color: #B22B31; }
.ansi-red-intense-bg { background-color: #B22B31; }
.ansi-green-fg { color: #00A250; }
.ansi-green-bg { background-color: #00A250; }
.ansi-green-intense-fg { color: #007427; }
.ansi-green-intense-bg { background-color: #007427; }
.ansi-yellow-fg { color: #DDB62B; }
.ansi-yellow-bg { background-color: #DDB62B; }
.ansi-yellow-intense-fg { color: #B27D12; }
.ansi-yellow-intense-bg { background-color: #B27D12; }
.ansi-blue-fg { color: #208FFB; }
.ansi-blue-bg { background-color: #208FFB; }
.ansi-blue-intense-fg { color: #0065CA; }
.ansi-blue-intense-bg { background-color: #0065CA; }
.ansi-magenta-fg { color: #D160C4; }
.ansi-magenta-bg { background-color: #D160C4; }
.ansi-magenta-intense-fg { color: #A03196; }
.ansi-magenta-intense-bg { background-color: #A03196; }
.ansi-cyan-fg { color: #60C6C8; }
.ansi-cyan-bg { background-color: #60C6C8; }
.ansi-cyan-intense-fg { color: #258F8F; }
.ansi-cyan-intense-bg { background-color: #258F8F; }
.ansi-white-fg { color: #C5C1B4; }
.ansi-white-bg { background-color: #C5C1B4; }
.ansi-white-intense-fg { color: #A1A6B2; }
.ansi-white-intense-bg { background-color: #A1A6B2; }

.ansi-default-inverse-fg { color: #FFFFFF; }
.ansi-default-inverse-bg { background-color: #000000; }

.ansi-bold { font-weight: bold; }
.ansi-underline { text-decoration: underline; }


div.nbinput.container div.input_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight] > pre,
div.nboutput.container div.output_area div[class*=highlight].math,
div.nboutput.container div.output_area.rendered_html,
div.nboutput.container div.output_area > div.output_javascript,
div.nboutput.container div.output_area:not(.rendered_html) > img{
    padding: 5px;
    margin: 0;
}

/* fix copybtn overflow problem in chromium (needed for 'sphinx_copybutton') */
div.nbinput.container div.input_area > div[class^='highlight'],
div.nboutput.container div.output_area > div[class^='highlight']{
    overflow-y: hidden;
}

/* hide copybtn icon on prompts (needed for 'sphinx_copybutton') */
.prompt .copybtn {
    display: none;
}

/* Some additional styling taken form the Jupyter notebook CSS */
div.rendered_html table {
  border: none;
  border-collapse: collapse;
  border-spacing: 0;
  color: black;
  font-size: 12px;
  table-layout: fixed;
}
div.rendered_html thead {
  border-bottom: 1px solid black;
  vertical-align: bottom;
}
div.rendered_html tr,
div.rendered_html th,
div.rendered_html td {
  text-align: right;
  vertical-align: middle;
  padding: 0.5em 0.5em;
  line-height: normal;
  white-space: normal;
  max-width: none;
  border: none;
}
div.rendered_html th {
  font-weight: bold;
}
div.rendered_html tbody tr:nth-child(odd) {
  background: #f5f5f5;
}
div.rendered_html tbody tr:hover {
  background: rgba(66, 165, 245, 0.2);
}
</style>
<section id="Making-stimuli">
<h1>Making stimuli<a class="headerlink" href="#Making-stimuli" title="Permalink to this headline">Â¶</a></h1>
<p>Silent substitution stimuli typically take the form of pulses or temporal modulations of photoreceptor-specific contrast presented against a background spectrum to which an observer has adapted. The background spectrum serves to maintain a set pattern of photoreceptor activations and the modulation spectrum increases activation of the targeted photoreceptor(s) without altering activation of the others.</p>
<img alt="_images/ss_example.svg" src="_images/ss_example.svg" /><p>The example above describes, for a 5-primary stimulation device, a pair of silent substitution spectra where melanopsin receives 250% modulation and the cones are silent. From left to right are shown the spectral power distributions, chromaticity coordinates, and photoreceptor-specific irradiances for the background and modulation spectra. Rods appear to be modulated, too, but in this example both spectra are ~1800 lux, so we expect rods to be saturated and reason that it is safe to ignore them.
We can see also that both spectra have the same chromaticity.</p>
<p>Arriving at a solution such as this requires groundwork. First, we need a <a class="reference internal" href="03a_stimulation_devices.html"><span class="doc">forward model of our stimulation device</span></a> that will predict the spectral output for any combination of settings. With that in place, we review the research goals: What photoreceptor(s) are we trying to isolate? How much contrast do we want to achieve? Do we wish to enforce any particular constraints on our stimuli? When we know the answer to these questions, we can formalise the problem
and look for a solution. Two ways of doing this, each of which has unique advantages, are with numerical optimization and linear algebra.</p>
<section id="Numerical-optimization">
<h2>Numerical optimization<a class="headerlink" href="#Numerical-optimization" title="Permalink to this headline">Â¶</a></h2>
<p>Silent substitution can be approached as a <a class="reference external" href="https://en.wikipedia.org/wiki/Constrained_optimization">constrained numerical optimization</a> problem of the form:</p>
<p><span class="math">\begin{equation}
\begin{array}{rrclcl}
& \underset{x \in \mathbb{R}^{n}}{\text{minimize}}
&  f(x) \\
& \text{subject to}
& g^{L} \le g(x) \le g^{U} \\
& & x^{L} \le x \le x^{U} ,
\end{array}
\end{equation}</span></p>
<p>where <span class="math notranslate nohighlight">\(x \in \mathbb{R}^{n}\)</span> are the optimization variables (the device settings) whose lower and upper bounds, <span class="math notranslate nohighlight">\(x^{L}\)</span> and <span class="math notranslate nohighlight">\(x^{U}\)</span>, are between 0 and 1 to ensure that the solution is within the gamut of the device, <span class="math notranslate nohighlight">\(f(x)\)</span> is the objective function that aims to maximise contrast of the target photoreceptor(s), and <span class="math notranslate nohighlight">\(g(x)\)</span> is a function that calculates contrast for the silenced photoreceptor(s), where <span class="math notranslate nohighlight">\(g^{L}\)</span> and <span class="math notranslate nohighlight">\(g^{U}\)</span> should be zero. In all cases,
<span class="math notranslate nohighlight">\(x\)</span> is a vector containing the weights for the LED settings.</p>
<p>Conveniently, <em>PySilSub</em> encapsulates this optimisation problem in a <code class="docutils literal notranslate"><span class="pre">SilentSubstitutionProblem</span></code> class that inherits everything from <code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code>. We can instantiate it in the same way, but this time including further information to condition the problem. As a basic demonstration, suppose we have calibration data for a linear, 8-bit, 5-primary stimulation system and that we want to find the settings for two spectra that will yield 250% contrast for melanopsin.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">pysilsub.problem</span> <span class="kn">import</span> <span class="n">SilentSubstitutionProblem</span>

<span class="c1"># Load the calibration data</span>
<span class="n">spds</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">read_csv</span><span class="p">(</span>
    <span class="s1">&#39;../../data/BCGAR_5_Primary_8_bit_linear.csv&#39;</span><span class="p">,</span>
    <span class="n">index_col</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;Primary&#39;</span><span class="p">,</span><span class="s1">&#39;Setting&#39;</span><span class="p">])</span>
<span class="n">spds</span><span class="o">.</span><span class="n">columns</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Int64Index</span><span class="p">(</span><span class="n">spds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">int</span><span class="p">))</span>
<span class="n">spds</span><span class="o">.</span><span class="n">columns</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="s1">&#39;Wavelength&#39;</span>

<span class="c1"># List of colors for the primaries</span>
<span class="n">colors</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;blue&#39;</span><span class="p">,</span> <span class="s1">&#39;cyan&#39;</span><span class="p">,</span> <span class="s1">&#39;green&#39;</span><span class="p">,</span> <span class="s1">&#39;orange&#39;</span><span class="p">,</span> <span class="s1">&#39;red&#39;</span><span class="p">]</span>

<span class="n">spds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[1]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Wavelength</th>
      <th>380</th>
      <th>381</th>
      <th>382</th>
      <th>383</th>
      <th>384</th>
      <th>385</th>
      <th>386</th>
      <th>387</th>
      <th>388</th>
      <th>389</th>
      <th>...</th>
      <th>771</th>
      <th>772</th>
      <th>773</th>
      <th>774</th>
      <th>775</th>
      <th>776</th>
      <th>777</th>
      <th>778</th>
      <th>779</th>
      <th>780</th>
    </tr>
    <tr>
      <th>Primary</th>
      <th>Setting</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th rowspan="5" valign="top">0</th>
      <th>0</th>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>...</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>7</th>
      <td>0.000068</td>
      <td>0.000071</td>
      <td>0.000062</td>
      <td>0.000068</td>
      <td>0.000055</td>
      <td>0.000055</td>
      <td>0.000064</td>
      <td>0.000051</td>
      <td>0.000063</td>
      <td>0.000074</td>
      <td>...</td>
      <td>0.000037</td>
      <td>0.000039</td>
      <td>0.000040</td>
      <td>0.000039</td>
      <td>0.000039</td>
      <td>0.000039</td>
      <td>0.000036</td>
      <td>0.000032</td>
      <td>0.000038</td>
      <td>0.000037</td>
    </tr>
    <tr>
      <th>15</th>
      <td>0.000137</td>
      <td>0.000141</td>
      <td>0.000123</td>
      <td>0.000136</td>
      <td>0.000109</td>
      <td>0.000111</td>
      <td>0.000127</td>
      <td>0.000101</td>
      <td>0.000126</td>
      <td>0.000148</td>
      <td>...</td>
      <td>0.000074</td>
      <td>0.000077</td>
      <td>0.000080</td>
      <td>0.000079</td>
      <td>0.000078</td>
      <td>0.000078</td>
      <td>0.000072</td>
      <td>0.000064</td>
      <td>0.000075</td>
      <td>0.000075</td>
    </tr>
    <tr>
      <th>23</th>
      <td>0.000205</td>
      <td>0.000212</td>
      <td>0.000185</td>
      <td>0.000204</td>
      <td>0.000164</td>
      <td>0.000166</td>
      <td>0.000191</td>
      <td>0.000152</td>
      <td>0.000189</td>
      <td>0.000222</td>
      <td>...</td>
      <td>0.000111</td>
      <td>0.000116</td>
      <td>0.000120</td>
      <td>0.000118</td>
      <td>0.000117</td>
      <td>0.000117</td>
      <td>0.000108</td>
      <td>0.000096</td>
      <td>0.000113</td>
      <td>0.000112</td>
    </tr>
    <tr>
      <th>31</th>
      <td>0.000274</td>
      <td>0.000282</td>
      <td>0.000247</td>
      <td>0.000272</td>
      <td>0.000219</td>
      <td>0.000222</td>
      <td>0.000254</td>
      <td>0.000202</td>
      <td>0.000252</td>
      <td>0.000296</td>
      <td>...</td>
      <td>0.000148</td>
      <td>0.000154</td>
      <td>0.000160</td>
      <td>0.000158</td>
      <td>0.000157</td>
      <td>0.000156</td>
      <td>0.000144</td>
      <td>0.000128</td>
      <td>0.000151</td>
      <td>0.000149</td>
    </tr>
    <tr>
      <th>...</th>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th rowspan="5" valign="top">4</th>
      <th>223</th>
      <td>0.003027</td>
      <td>0.003555</td>
      <td>0.003159</td>
      <td>0.003563</td>
      <td>0.002712</td>
      <td>0.002951</td>
      <td>0.002827</td>
      <td>0.002159</td>
      <td>0.003197</td>
      <td>0.003623</td>
      <td>...</td>
      <td>0.001990</td>
      <td>0.002227</td>
      <td>0.002264</td>
      <td>0.002182</td>
      <td>0.002558</td>
      <td>0.002361</td>
      <td>0.002268</td>
      <td>0.001905</td>
      <td>0.002162</td>
      <td>0.002360</td>
    </tr>
    <tr>
      <th>231</th>
      <td>0.003135</td>
      <td>0.003682</td>
      <td>0.003271</td>
      <td>0.003690</td>
      <td>0.002808</td>
      <td>0.003056</td>
      <td>0.002928</td>
      <td>0.002237</td>
      <td>0.003311</td>
      <td>0.003753</td>
      <td>...</td>
      <td>0.002061</td>
      <td>0.002306</td>
      <td>0.002345</td>
      <td>0.002259</td>
      <td>0.002649</td>
      <td>0.002446</td>
      <td>0.002349</td>
      <td>0.001973</td>
      <td>0.002239</td>
      <td>0.002445</td>
    </tr>
    <tr>
      <th>239</th>
      <td>0.003243</td>
      <td>0.003809</td>
      <td>0.003384</td>
      <td>0.003817</td>
      <td>0.002905</td>
      <td>0.003162</td>
      <td>0.003029</td>
      <td>0.002314</td>
      <td>0.003426</td>
      <td>0.003882</td>
      <td>...</td>
      <td>0.002132</td>
      <td>0.002386</td>
      <td>0.002426</td>
      <td>0.002337</td>
      <td>0.002741</td>
      <td>0.002530</td>
      <td>0.002430</td>
      <td>0.002041</td>
      <td>0.002316</td>
      <td>0.002529</td>
    </tr>
    <tr>
      <th>247</th>
      <td>0.003351</td>
      <td>0.003936</td>
      <td>0.003497</td>
      <td>0.003944</td>
      <td>0.003002</td>
      <td>0.003267</td>
      <td>0.003130</td>
      <td>0.002391</td>
      <td>0.003540</td>
      <td>0.004011</td>
      <td>...</td>
      <td>0.002203</td>
      <td>0.002465</td>
      <td>0.002507</td>
      <td>0.002415</td>
      <td>0.002832</td>
      <td>0.002614</td>
      <td>0.002511</td>
      <td>0.002109</td>
      <td>0.002394</td>
      <td>0.002613</td>
    </tr>
    <tr>
      <th>255</th>
      <td>0.003459</td>
      <td>0.004063</td>
      <td>0.003610</td>
      <td>0.004071</td>
      <td>0.003099</td>
      <td>0.003373</td>
      <td>0.003231</td>
      <td>0.002468</td>
      <td>0.003654</td>
      <td>0.004141</td>
      <td>...</td>
      <td>0.002274</td>
      <td>0.002545</td>
      <td>0.002587</td>
      <td>0.002493</td>
      <td>0.002923</td>
      <td>0.002699</td>
      <td>0.002592</td>
      <td>0.002177</td>
      <td>0.002471</td>
      <td>0.002698</td>
    </tr>
  </tbody>
</table>
<p>165 rows Ã 401 columns</p>
</div></div>
</div>
<p>We can pass these data to <code class="docutils literal notranslate"><span class="pre">SilentSubstitutionProblem</span></code>âjust like we did with <code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code>âonly this time we specify which photoreceptors to ignore, which of them to silence, and which to isolate.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[2]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysilsub.problem</span> <span class="kn">import</span> <span class="n">SilentSubstitutionProblem</span> <span class="k">as</span> <span class="n">SSP</span>

<span class="n">ssp</span> <span class="o">=</span> <span class="n">SSP</span><span class="p">(</span>
    <span class="n">resolutions</span><span class="o">=</span><span class="p">[</span><span class="mi">255</span><span class="p">]</span><span class="o">*</span><span class="mi">5</span><span class="p">,</span>  <span class="c1"># Five 8-bit primaries</span>
    <span class="n">colors</span><span class="o">=</span><span class="n">colors</span><span class="p">,</span>  <span class="c1"># Colors of the LEDs</span>
    <span class="n">spds</span><span class="o">=</span><span class="n">spds</span><span class="p">,</span>  <span class="c1"># The calibration data</span>
    <span class="n">spd_binwidth</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>  <span class="c1"># SPD wavelength binwidth</span>
    <span class="n">ignore</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;R&#39;</span><span class="p">],</span>  <span class="c1"># Ignore rods</span>
    <span class="n">silence</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">,</span> <span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">],</span>  <span class="c1"># Silence S-, M-, and L-cones</span>
    <span class="n">isolate</span><span class="o">=</span><span class="p">[</span><span class="s1">&#39;I&#39;</span><span class="p">],</span>  <span class="c1"># Isolate melanopsin</span>
    <span class="n">target_contrast</span><span class="o">=</span><span class="mf">2.5</span><span class="p">,</span>  <span class="c1"># Aim for 250% contrast</span>
    <span class="n">name</span><span class="o">=</span><span class="s1">&#39;BCGAR (8-bit, linear)&#39;</span>  <span class="c1"># Description of device</span>
<span class="p">)</span>
</pre></div>
</div>
</div>
<p>Because <code class="docutils literal notranslate"><span class="pre">StimulationDevice</span></code> is the base class we can do all the cool things described <a class="reference internal" href="03a_stimulation_devices.html"><span class="doc">here</span></a>, like plotting the spds and the gamut of the device. But lets get straight on to the optimisation.</p>
<p>As a general note, numerical optimisation is a big old topic and there are many algorithms available, each with their own idiosynchrasies. At present, <em>PySilSub</em> does not know the best algorithm for your stimulation device and research goals, nor does it unite different algorithms under a common calling syntax. It simply encapsulates your problem in the form of ready made functions that you can pass to an optimiser. So, If you are new to optimisation in Python, itâs worth investing a bit of time
to learn the basics. <a class="reference external" href="https://realpython.com/python-scipy-cluster-optimize/">This article</a> is a good place to start.</p>
<p>Though not the only option, Scipyâs <code class="docutils literal notranslate"><span class="pre">optimize</span></code> module is comprehensive and contains a range of methods for local and global optisation with linear or nonlinear constraints. In this case we will use the <a class="reference external" href="https://docs.scipy.org/doc/scipy-1.8.0/html-scipyorg/reference/optimize.minimize-slsqp.html">SLSQP</a> solver with Scipyâs <code class="docutils literal notranslate"><span class="pre">optimize.minimize</span></code> function.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">scipy.optimize</span> <span class="kn">import</span> <span class="n">minimize</span>

<span class="c1"># Initial guess for optimisation variables</span>
<span class="n">x0</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">initial_guess_x0</span><span class="p">()</span>

<span class="c1"># The silencing constraint is an equality</span>
<span class="c1"># constraint defined in the standard scipy</span>
<span class="c1"># format.</span>
<span class="n">constraints</span> <span class="o">=</span> <span class="p">{</span>
    <span class="s1">&#39;type&#39;</span><span class="p">:</span> <span class="s1">&#39;eq&#39;</span><span class="p">,</span>
    <span class="s1">&#39;fun&#39;</span><span class="p">:</span> <span class="n">ssp</span><span class="o">.</span><span class="n">silencing_constraint</span><span class="p">,</span>
    <span class="s1">&#39;ftol&#39;</span><span class="p">:</span> <span class="mf">1e-07</span>
    <span class="p">}</span>

<span class="c1"># Perform the optimisation</span>
<span class="n">result</span> <span class="o">=</span> <span class="n">minimize</span><span class="p">(</span>
    <span class="n">fun</span><span class="o">=</span><span class="n">ssp</span><span class="o">.</span><span class="n">objective_function</span><span class="p">,</span>
    <span class="n">x0</span><span class="o">=</span><span class="n">x0</span><span class="p">,</span>
    <span class="n">method</span><span class="o">=</span><span class="s1">&#39;SLSQP&#39;</span><span class="p">,</span>
    <span class="n">bounds</span><span class="o">=</span><span class="n">ssp</span><span class="o">.</span><span class="n">bounds</span><span class="p">,</span>
    <span class="n">constraints</span><span class="o">=</span><span class="n">constraints</span><span class="p">,</span>
    <span class="n">tol</span><span class="o">=</span><span class="mf">1e-07</span>
<span class="p">)</span>

<span class="n">result</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[3]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
     fun: 3.4687435975785355e-09
     jac: array([ -5.75445672e-03,  -1.10053212e-02,  -8.89814623e-03,
        -1.40415965e-03,  -2.18769410e-04,   1.89077494e-03,
         3.18125650e-03,   2.24496426e-03,   4.59190153e-04,
         5.46986117e-05])
 message: &#39;Optimization terminated successfully&#39;
    nfev: 701
     nit: 60
    njev: 60
  status: 0
 success: True
       x: array([  3.64725695e-02,   0.00000000e+00,   6.77943940e-05,
         1.66243135e-01,   2.54857811e-04,   0.00000000e+00,
         2.51008818e-02,   1.43483297e-01,   1.86159038e-02,
         1.00000000e+00])
</pre></div></div>
</div>
<p>Printed above is the result of the optimisation in Scipyâs standard <code class="docutils literal notranslate"><span class="pre">OptimizationResult</span></code> format. The low value of <code class="docutils literal notranslate"><span class="pre">fun</span></code> indicates that we are very close to the target contrast of 250%. Unsurprisingly, what we actually need is <code class="docutils literal notranslate"><span class="pre">result.x</span></code>. Visualising the result is straight forward.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[4]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_fig</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">plot_ss_result</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">)</span>
<span class="n">result_fig</span><span class="o">.</span><span class="n">savefig</span><span class="p">(</span><span class="s1">&#39;../../img/ss_example.svg&#39;</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
        Background luminance: 1794.8826686914454
        Modulation luminance: 1794.8835907203427
        Background xy: [ 0.52748464  0.3747774 ]
        Modulation xy: [ 0.52741232  0.37482878]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_making_stimuli_9_1.png" src="_images/03b_making_stimuli_9_1.png" />
</div>
</div>
<p>Voilaâa pair of silent substitution spectra. Converting the optimisation result to 8-bit settings for the stimulation device is easy.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">bg_settings</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">weights_to_settings</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[:</span><span class="mi">5</span><span class="p">])</span>
<span class="n">bg_settings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[5]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[9, 0, 0, 42, 0]
</pre></div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">mod_settings</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">weights_to_settings</span><span class="p">(</span><span class="n">result</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">5</span><span class="p">:])</span>
<span class="n">mod_settings</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[6]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0, 6, 36, 4, 255]
</pre></div></div>
</div>
<p>All being well, if we pass these settings to the stimulation device it will produce these two spectra. But see here for various challanges and caveats.</p>
</section>
<section id="Linear-algebra">
<h2>Linear algebra<a class="headerlink" href="#Linear-algebra" title="Permalink to this headline">Â¶</a></h2>
<p>Silent substitution problems can also be solved with linear algebra. Continuing with our 5-primary example, suppose that we now want to isolate S-cones.</p>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[7]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">ssp</span><span class="o">.</span><span class="n">isolate</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;S&#39;</span><span class="p">]</span>
<span class="n">ssp</span><span class="o">.</span><span class="n">silence</span> <span class="o">=</span> <span class="p">[</span><span class="s1">&#39;M&#39;</span><span class="p">,</span> <span class="s1">&#39;L&#39;</span><span class="p">,</span> <span class="s1">&#39;I&#39;</span><span class="p">]</span>
</pre></div>
</div>
</div>
<p>For a background spectrum we will take the mixture of all primaries at half-max power, <span class="math notranslate nohighlight">\(\alpha_{bg} = [.5 \ .5 \ .5 \ .5 \ .5]\)</span>. Note that in this case we are not summing the predicted spectra as weâll be doing matrix algebra involving the individual primaries.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">abg</span> <span class="o">=</span> <span class="p">[</span><span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">,</span> <span class="mf">.5</span><span class="p">]</span>
<span class="n">bg_spds</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">predict_multiprimary_spd</span><span class="p">(</span><span class="n">abg</span><span class="p">,</span> <span class="n">nosum</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="n">bg_spds</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[18]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Primary</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>Wavelength</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>380</th>
      <td>0.001098</td>
      <td>0.000856</td>
      <td>0.001115</td>
      <td>0.001842</td>
      <td>0.001736</td>
    </tr>
    <tr>
      <th>381</th>
      <td>0.001134</td>
      <td>0.000933</td>
      <td>0.001191</td>
      <td>0.002067</td>
      <td>0.002040</td>
    </tr>
    <tr>
      <th>382</th>
      <td>0.000991</td>
      <td>0.000838</td>
      <td>0.001198</td>
      <td>0.001945</td>
      <td>0.001812</td>
    </tr>
    <tr>
      <th>383</th>
      <td>0.001091</td>
      <td>0.000828</td>
      <td>0.001231</td>
      <td>0.001945</td>
      <td>0.002044</td>
    </tr>
    <tr>
      <th>384</th>
      <td>0.000879</td>
      <td>0.000745</td>
      <td>0.001003</td>
      <td>0.001673</td>
      <td>0.001556</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>776</th>
      <td>0.000625</td>
      <td>0.000533</td>
      <td>0.000710</td>
      <td>0.002349</td>
      <td>0.001355</td>
    </tr>
    <tr>
      <th>777</th>
      <td>0.000577</td>
      <td>0.000525</td>
      <td>0.000693</td>
      <td>0.002305</td>
      <td>0.001301</td>
    </tr>
    <tr>
      <th>778</th>
      <td>0.000516</td>
      <td>0.000398</td>
      <td>0.000562</td>
      <td>0.002146</td>
      <td>0.001093</td>
    </tr>
    <tr>
      <th>779</th>
      <td>0.000605</td>
      <td>0.000539</td>
      <td>0.000733</td>
      <td>0.002114</td>
      <td>0.001240</td>
    </tr>
    <tr>
      <th>780</th>
      <td>0.000600</td>
      <td>0.000559</td>
      <td>0.000826</td>
      <td>0.002350</td>
      <td>0.001354</td>
    </tr>
  </tbody>
</table>
<p>401 rows Ã 5 columns</p>
</div></div>
</div>
<p>Next, weâll be needing the spectral sensitivities for the photoreceptors.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">pysilsub.CIE</span> <span class="kn">import</span> <span class="n">get_CIES026</span>

<span class="n">sss</span> <span class="o">=</span> <span class="n">get_CIES026</span><span class="p">()</span>
<span class="n">sss</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[19]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Photoreceptor</th>
      <th>S</th>
      <th>M</th>
      <th>L</th>
      <th>R</th>
      <th>I</th>
    </tr>
    <tr>
      <th>Wavelength</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>380</th>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>5.890000e-04</td>
      <td>9.181600e-04</td>
    </tr>
    <tr>
      <th>381</th>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>6.650000e-04</td>
      <td>1.045600e-03</td>
    </tr>
    <tr>
      <th>382</th>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>7.520000e-04</td>
      <td>1.178600e-03</td>
    </tr>
    <tr>
      <th>383</th>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>8.540000e-04</td>
      <td>1.322800e-03</td>
    </tr>
    <tr>
      <th>384</th>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.000000</td>
      <td>9.720000e-04</td>
      <td>1.483800e-03</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>776</th>
      <td>0.0</td>
      <td>0.000002</td>
      <td>0.000024</td>
      <td>1.730000e-07</td>
      <td>2.550000e-08</td>
    </tr>
    <tr>
      <th>777</th>
      <td>0.0</td>
      <td>0.000002</td>
      <td>0.000023</td>
      <td>1.640000e-07</td>
      <td>2.420000e-08</td>
    </tr>
    <tr>
      <th>778</th>
      <td>0.0</td>
      <td>0.000002</td>
      <td>0.000021</td>
      <td>1.550000e-07</td>
      <td>2.290000e-08</td>
    </tr>
    <tr>
      <th>779</th>
      <td>0.0</td>
      <td>0.000002</td>
      <td>0.000020</td>
      <td>1.470000e-07</td>
      <td>2.170000e-08</td>
    </tr>
    <tr>
      <th>780</th>
      <td>0.0</td>
      <td>0.000001</td>
      <td>0.000019</td>
      <td>1.390000e-07</td>
      <td>2.050000e-08</td>
    </tr>
  </tbody>
</table>
<p>401 rows Ã 5 columns</p>
</div></div>
</div>
<p>The dot product of these matrices, which we will call <span class="math notranslate nohighlight">\(A\)</span>, contains the <em>a</em>-opic irradiances for the primary components of the background spectrum.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">A</span> <span class="o">=</span> <span class="n">sss</span><span class="o">.</span><span class="n">T</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">bg_spds</span><span class="p">)</span>
<span class="n">A</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[37]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Primary</th>
      <th>0</th>
      <th>1</th>
      <th>2</th>
      <th>3</th>
      <th>4</th>
    </tr>
    <tr>
      <th>Photoreceptor</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>S</th>
      <td>3.580009</td>
      <td>2.453689</td>
      <td>0.211358</td>
      <td>0.095264</td>
      <td>0.057067</td>
    </tr>
    <tr>
      <th>M</th>
      <td>0.627573</td>
      <td>1.355843</td>
      <td>3.573256</td>
      <td>4.683028</td>
      <td>0.156777</td>
    </tr>
    <tr>
      <th>L</th>
      <td>0.435727</td>
      <td>0.873636</td>
      <td>2.915142</td>
      <td>8.686473</td>
      <td>0.853310</td>
    </tr>
    <tr>
      <th>R</th>
      <td>1.730730</td>
      <td>2.965132</td>
      <td>3.638927</td>
      <td>1.288265</td>
      <td>0.076642</td>
    </tr>
    <tr>
      <th>I</th>
      <td>2.094721</td>
      <td>3.520715</td>
      <td>2.841600</td>
      <td>0.509312</td>
      <td>0.069365</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<p>Now, the unique scaling coefficients for the primaries <span class="math notranslate nohighlight">\(\alpha_{sc} = [p_{0} \ p_{1} \ p_{2} \ p_{3} \ p_{4}]\)</span> that must be added to the primary weights for the background <span class="math notranslate nohighlight">\(\alpha_{bg}\)</span> for a requested modulation <span class="math notranslate nohighlight">\(\beta = [S \ M \ L \ R \ I]\)</span> are discovered as <span class="math notranslate nohighlight">\(\alpha_{sc} = \beta A^{-1}\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>

<span class="c1"># Calculate inverse of A</span>
<span class="n">A1</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
    <span class="n">np</span><span class="o">.</span><span class="n">linalg</span><span class="o">.</span><span class="n">inv</span><span class="p">(</span><span class="n">A</span><span class="o">.</span><span class="n">values</span><span class="p">),</span>
    <span class="n">A</span><span class="o">.</span><span class="n">columns</span><span class="p">,</span>
    <span class="n">A</span><span class="o">.</span><span class="n">index</span><span class="p">)</span>
<span class="n">A1</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[38]:
</pre></div>
</div>
<div class="output_area rendered_html docutils container">
<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>Photoreceptor</th>
      <th>S</th>
      <th>M</th>
      <th>L</th>
      <th>R</th>
      <th>I</th>
    </tr>
    <tr>
      <th>Primary</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.473797</td>
      <td>-0.159332</td>
      <td>-0.001803</td>
      <td>0.993080</td>
      <td>-1.104764</td>
    </tr>
    <tr>
      <th>1</th>
      <td>-0.279487</td>
      <td>0.340021</td>
      <td>-0.037472</td>
      <td>-1.654925</td>
      <td>1.750941</td>
    </tr>
    <tr>
      <th>2</th>
      <td>-0.002424</td>
      <td>-0.286409</td>
      <td>0.015329</td>
      <td>1.342032</td>
      <td>-1.022070</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.026572</td>
      <td>0.502356</td>
      <td>-0.059770</td>
      <td>-0.855885</td>
      <td>0.523675</td>
    </tr>
    <tr>
      <th>4</th>
      <td>-0.218010</td>
      <td>-4.402157</td>
      <td>1.767262</td>
      <td>5.315177</td>
      <td>-3.067724</td>
    </tr>
  </tbody>
</table>
</div></div>
</div>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="c1"># Requested modulation for S-cones</span>
<span class="c1"># S, M, L, R, I</span>
<span class="n">b</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span><span class="mf">1.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">,</span> <span class="mf">0.</span><span class="p">])</span>

<span class="c1"># Calculate the scaling coefficients</span>
<span class="n">asc</span> <span class="o">=</span> <span class="n">A1</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">b</span><span class="p">)</span>
<span class="n">asc</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[39]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
Primary
0    0.473797
1   -0.279487
2   -0.002424
3    0.026572
4   -0.218010
dtype: float64
</pre></div></div>
</div>
<p>Following on from above, <span class="math notranslate nohighlight">\(\alpha_{mod} = \alpha_{bg} + \alpha_{sc}\)</span>.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">amod</span> <span class="o">=</span> <span class="p">(</span><span class="n">abg</span> <span class="o">+</span> <span class="n">asc</span><span class="p">)</span><span class="o">.</span><span class="n">to_list</span><span class="p">()</span>
<span class="n">amod</span>
</pre></div>
</div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[40]:
</pre></div>
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
[0.9737967205732633,
 0.2205128840696679,
 0.497575760149633,
 0.5265724940899263,
 0.28198992315052973]
</pre></div></div>
</div>
<p>Obviously, these values need to be between zero and one for the solution to be valid, which in this case they are. As before, we can visualise the solution.</p>
<div class="nbinput docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[41]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span><span class="n">result_fig</span> <span class="o">=</span> <span class="n">ssp</span><span class="o">.</span><span class="n">plot_ss_result</span><span class="p">(</span><span class="n">abg</span> <span class="o">+</span> <span class="n">amod</span><span class="p">)</span>
</pre></div>
</div>
</div>
<div class="nboutput docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<div class="highlight"><pre>
        Background luminance: 8996.204095646926
        Modulation luminance: 8996.271148062795
        Background xy: [ 0.36478141  0.31094694]
        Modulation xy: [ 0.3434773   0.27744979]
</pre></div></div>
</div>
<div class="nboutput nblast docutils container">
<div class="prompt empty docutils container">
</div>
<div class="output_area docutils container">
<img alt="_images/03b_making_stimuli_28_1.png" src="_images/03b_making_stimuli_28_1.png" />
</div>
</div>
<div class="nbinput nblast docutils container">
<div class="prompt highlight-none notranslate"><div class="highlight"><pre><span></span>[ ]:
</pre></div>
</div>
<div class="input_area highlight-ipython3 notranslate"><div class="highlight"><pre><span></span>
</pre></div>
</div>
</div>
</section>
</section>


          </div>
          
        </div>
      </div>
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
            <p class="logo"><a href="index.html">
              <img class="logo" src="_static/photoreceptor_characters.png" alt="Logo"/>
            </a></p>
<h1 class="logo"><a href="index.html">PySilSub</a></h1>



<p class="blurb">A Python software for performing the method of silent substitution.</p>




<p>
<iframe src="https://ghbtns.com/github-btn.html?user=PySilentSubstitution&repo=pysilsub&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<p class="caption" role="heading"><span class="caption-text">Contents:</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="01_background.html">Background</a></li>
<li class="toctree-l1"><a class="reference internal" href="02_installation.html">Installation</a></li>
<li class="toctree-l1 current"><a class="reference internal" href="03_overview.html">Overview</a><ul class="current">
<li class="toctree-l2"><a class="reference internal" href="03a_stimulation_devices.html">Stimulation devices</a></li>
<li class="toctree-l2 current"><a class="current reference internal" href="#">Making stimuli</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="05_examples.html">Worked examples</a></li>
<li class="toctree-l1"><a class="reference internal" href="06_api.html">API</a></li>
<li class="toctree-l1"><a class="reference internal" href="09_funding.html">Funding</a></li>
<li class="toctree-l1"><a class="reference internal" href="10_citation.html">Citation</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="index.html">Documentation overview</a><ul>
  <li><a href="03_overview.html">Overview</a><ul>
      <li>Previous: <a href="03a_stimulation_devices.html" title="previous chapter">Stimulation devices</a></li>
      <li>Next: <a href="05_examples.html" title="next chapter">Worked examples</a></li>
  </ul></li>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3 id="searchlabel">Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="search.html" method="get">
      <input type="text" name="q" aria-labelledby="searchlabel" autocomplete="off" autocorrect="off" autocapitalize="off" spellcheck="false"/>
      <input type="submit" value="Go" />
    </form>
    </div>
</div>
<script>$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="clearer"></div>
    </div>
    <div class="footer">
      &copy;2022, Joel T. Martin.
      
      |
      Powered by <a href="http://sphinx-doc.org/">Sphinx 4.4.0</a>
      &amp; <a href="https://github.com/bitprophet/alabaster">Alabaster 0.7.12</a>
      
      |
      <a href="_sources/03b_making_stimuli.ipynb.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>